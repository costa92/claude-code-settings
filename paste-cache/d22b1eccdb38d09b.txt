   - å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%

3. **ç¨³å®šæ€§**ï¼š
   - æ ‘ç´¢å¼•å¤±è´¥ä¸å½±å“å‘é‡æ£€ç´¢
   - æ‰€æœ‰ç°æœ‰æµ‹è¯•é€šè¿‡
   - æ— å†…å­˜æ³„æ¼

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              RAGService (ç¼–æ’å±‚)                â”‚
â”‚  - IndexDocument(): ç´¢å¼•æ–‡æ¡£                    â”‚
â”‚  - Query(): æ‰§è¡ŒæŸ¥è¯¢                            â”‚
â”‚  - é…ç½®å¼€å…³: rag.tree.enabled                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                     â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Indexer      â”‚    â”‚   Retriever     â”‚
    â”‚  (ç°æœ‰å‘é‡)    â”‚    â”‚  (ç°æœ‰å‘é‡)     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                     â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  TreeBuilder   â”‚    â”‚ TreeRetriever   â”‚
    â”‚  (æ–°å¢æ ‘ç´¢å¼•)  â”‚    â”‚ (æ–°å¢æ ‘æ£€ç´¢)    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   VectorStore    â”‚
            â”‚  (æ‰©å±•Schema)    â”‚
            â”‚  + level         â”‚
            â”‚  + parent_id     â”‚
            â”‚  + node_type     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### TreeBuilder å·¥ä½œæµ

```
è¾“å…¥ï¼šDocument
    â†“
1. å¤ç”¨ Indexer åˆ†å— â†’ å¶å­èŠ‚ç‚¹ (Level 0)
    â†“
2. é€’å½’æ„å»ºä¸Šå±‚èŠ‚ç‚¹ï¼š
   â”œâ”€ KMeans èšç±»ï¼ˆnum_clusters=5ï¼‰
   â”œâ”€ å¹¶è¡Œç”Ÿæˆæ‘˜è¦ï¼ˆä½¿ç”¨ pool æ§åˆ¶å¹¶å‘ï¼‰
   â”œâ”€ ç”Ÿæˆæ‘˜è¦ Embedding
   â””â”€ ç»ˆæ­¢æ¡ä»¶ï¼šèŠ‚ç‚¹æ•° â‰¤ 5 æˆ– è¾¾åˆ° max_level=3
    â†“
3. æ‰¹é‡å­˜å‚¨åˆ° VectorStoreï¼ˆå¸¦ level, parent_id å…ƒæ•°æ®ï¼‰
    â†“
è¾“å‡ºï¼šTree Metadata (root_id, max_level, node_count)
```

### TreeRetriever æ£€ç´¢ç­–ç•¥

**ä¸‰é˜¶æ®µæ··åˆæ£€ç´¢**ï¼š

```
é˜¶æ®µ1: è‡ªé¡¶å‘ä¸‹è·¯å¾„æŸ¥æ‰¾
  - ä»æ ¹èŠ‚ç‚¹å¼€å§‹ç›¸ä¼¼åº¦æœç´¢ (topK=3)
  - é€’å½’å‘ä¸‹æŸ¥æ‰¾æœ€ç›¸å…³å­èŠ‚ç‚¹
  - æ”¶é›†è·¯å¾„ä¸Šçš„æ‰€æœ‰èŠ‚ç‚¹ â†’ PathNodes

é˜¶æ®µ2: å¶å­å±‚å…¨å±€æ£€ç´¢
  - åœ¨ Level 0 æ‰§è¡Œå‘é‡æ£€ç´¢ (topK=20)
  - è¿‡æ»¤å·²åœ¨ PathNodes ä¸­çš„èŠ‚ç‚¹
  - æ”¶é›†è¡¥å……å¶å­èŠ‚ç‚¹ â†’ LeafNodes

é˜¶æ®µ3: ç»¼åˆæ’åº
  - åˆå¹¶ PathNodes + LeafNodes
  - ç»¼åˆè¯„åˆ† = ç›¸ä¼¼åº¦ Ã— 0.7 + å±‚çº§æƒé‡ Ã— 0.3
  - è¿”å› Top-K ç»“æœ
```

---

## ğŸ“‚ å…³é”®æ–‡ä»¶ä¿®æ”¹æ¸…å•

### P0 - æ ¸å¿ƒåŸºç¡€è®¾æ–½ï¼ˆç¬¬ 1-2 å¤©ï¼‰

**å¿…é¡»å…ˆå®Œæˆï¼Œå…¶ä»–åŠŸèƒ½ä¾èµ–è¿™äº›åŸºç¡€**

1. **`internal/rag/store/store.go`**
   - ä¿®æ”¹ï¼šæ‰©å±• `Chunk` ç»“æ„ä½“
   ```go
   type Chunk struct {
       // ... ç°æœ‰å­—æ®µ
       Level    int    `json:"level"`     // æ–°å¢
       ParentID string `json:"parent_id"` // æ–°å¢
       NodeType int    `json:"node_type"` // æ–°å¢ï¼š0=å¶å­,1=ä¸­é—´,2=æ ¹
   }
   ```
   - æ–°å¢æ–¹æ³•ï¼š`SearchWithFilter(expr string)` æ¥å£

2. **`internal/rag/store/milvus.go`**
   - ä¿®æ”¹ Schemaï¼šæ·»åŠ  `level`, `parent_id`, `node_type` å­—æ®µ
   - å®ç° `SearchWithFilter` æ–¹æ³•ï¼ˆæ”¯æŒ Milvus Expr è¿‡æ»¤ï¼‰
   - æ·»åŠ å­—æ®µç´¢å¼•åˆ›å»ºé€»è¾‘

3. **`configs/rag.yaml`**
   - æ·»åŠ é…ç½®èŠ‚ç‚¹ï¼š
   ```yaml
   rag:
     tree:
       enabled: false        # POC å¼€å…³
       max-level: 3          # æ ‘æœ€å¤§å±‚çº§
       num-clusters: 5       # æ¯å±‚èšç±»æ•°
       summary-model: "deepseek-chat"  # æ‘˜è¦æ¨¡å‹
   ```

### P1 - TreeBuilder å®ç°ï¼ˆç¬¬ 3-6 å¤©ï¼‰

4. **`internal/rag/biz/tree_builder.go`** [æ–°å»º]
   - å®ç° `TreeBuilder` ç»“æ„ä½“å’Œæ ¸å¿ƒé€»è¾‘
   - ä¸»è¦æ–¹æ³•ï¼š
     - `BuildTree(doc)`: å…¥å£æ–¹æ³•
     - `buildLevels(nodes, level)`: é€’å½’æ„å»ºå±‚çº§
     - `createParentNode(children)`: ç”Ÿæˆçˆ¶èŠ‚ç‚¹
   - é›†æˆ `pkg/infra/pool` æ§åˆ¶å¹¶å‘

5. **`internal/rag/biz/cluster.go`** [æ–°å»º]
   - å®ç° KMeans èšç±»ç®—æ³•
   - ä½¿ç”¨å‘é‡ç›¸ä¼¼åº¦è¿›è¡Œåˆ†ç»„

6. **`internal/rag/biz/summarizer.go`** [æ–°å»º]
   - å®ç°æ‘˜è¦ç”Ÿæˆé€»è¾‘
   - Prompt è®¾è®¡ï¼š
   ```
   è¯·å¯¹ä»¥ä¸‹æ–‡æœ¬ç”Ÿæˆç®€æ´æ‘˜è¦ï¼Œé•¿åº¦ä¸è¶…è¿‡ 200 å­—ç¬¦ã€‚
   æ‘˜è¦åº”æå–æ ¸å¿ƒä¸»é¢˜å’Œå…³é”®ä¿¡æ¯ï¼Œä¿æŒè¯­ä¹‰å®Œæ•´æ€§ã€‚
   åŸæ–‡ï¼š{content}
   æ‘˜è¦ï¼š
   ```

### P2 - TreeRetriever å®ç°ï¼ˆç¬¬ 7-10 å¤©ï¼‰

7. **`internal/rag/biz/tree_retriever.go`** [æ–°å»º]
   - å®ç° `TreeRetriever` ç»“æ„ä½“
   - ä¸‰é˜¶æ®µæ£€ç´¢é€»è¾‘
   - ç»¼åˆæ’åºç®—æ³•

8. **`internal/rag/biz/path_finder.go`** [æ–°å»º]
   - è‡ªé¡¶å‘ä¸‹è·¯å¾„æŸ¥æ‰¾
   - é€’å½’éå†æ ‘èŠ‚ç‚¹

### P3 - é›†æˆå’Œæµ‹è¯•ï¼ˆç¬¬ 11-15 å¤©ï¼‰

9. **`internal/rag/biz/service.go`**
   - ä¿®æ”¹ `IndexFromURL` æ–¹æ³•ï¼š
   ```go
   if s.config.Tree.Enabled {
       if err := s.treeBuilder.BuildTree(ctx, doc); err != nil {
           logger.Warnw("tree build failed, skip", "error", err)
           // ï¿½ï¿½ï¿½é˜»å¡å¤±è´¥
       }
   }
   ```
   - ä¿®æ”¹ `Query` æ–¹æ³•ï¼ˆç»“æœèåˆï¼‰

10. **æµ‹è¯•æ–‡ä»¶** [æ–°å»º]
    - `internal/rag/biz/tree_builder_test.go`
    - `internal/rag/biz/tree_retriever_test.go`
    - `internal/rag/biz/service_integration_test.go`

---

## ğŸ”§ å®æ–½æ­¥éª¤ï¼ˆè¯¦ç»†æ‰§è¡Œé¡ºåºï¼‰

### ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€è®¾æ–½å‡†å¤‡ï¼ˆ1-2 å¤©ï¼‰

**æ­¥éª¤ 1ï¼šæ‰©å±• VectorStore æ•°æ®ç»“æ„**
```bash
# 1. ä¿®æ”¹ Chunk ç»“æ„ä½“
vim internal/rag/store/store.go
# æ·»åŠ  Level, ParentID, NodeType å­—æ®µ

# 2. æ›´æ–° Milvus Schema
vim internal/rag/store/milvus.go
# åœ¨ CreateCollection ä¸­æ·»åŠ å­—æ®µå®šä¹‰

# 3. éªŒè¯
go test ./internal/rag/store/... -v
```

**æ­¥éª¤ 2ï¼šå®ç°è¿‡æ»¤æŸ¥è¯¢æ–¹æ³•**
```go
// internal/rag/store/milvus.go
func (s *milvusStore) SearchWithFilter(
    ctx context.Context,
    collection string,
    embedding []float32,
    expr string,  // å¦‚ "level == 1"
    topK int,
) ([]*SearchResult, error) {
    // ä½¿ç”¨ Milvus Client çš„ Search APIï¼Œä¼ å…¥ expr å‚æ•°
}
```

**æ­¥éª¤ 3ï¼šæ·»åŠ é…ç½®**
```bash
# 1. ä¿®æ”¹é…ç½®æ–‡ä»¶
vim configs/rag.yaml
# æ·»åŠ  tree é…ç½®èŠ‚ç‚¹

# 2. æ›´æ–°é…ç½®ç»“æ„ä½“
# ç¡®ä¿ Viper èƒ½æ­£ç¡®åŠ è½½

# 3. éªŒè¯é…ç½®åŠ è½½
go run cmd/rag/main.go --config configs/rag.yaml
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… Milvus Schema åŒ…å«æ–°å­—æ®µ
- âœ… SearchWithFilter æ–¹æ³•å¯ç”¨
- âœ… é…ç½®æ­£ç¡®åŠ è½½

---

### ç¬¬äºŒé˜¶æ®µï¼šTreeBuilder å®ç°ï¼ˆ3-6 å¤©ï¼‰

**æ­¥éª¤ 4ï¼šå®ç°èšç±»ç®—æ³•**
```go
// internal/rag/biz/cluster.go
type KMeansClusterer struct{}

func (c *KMeansClusterer) Cluster(
    nodes []*TreeNode,
    numClusters int,
) ([][]*TreeNode, error) {
    // 1. æå– Embeddings
    // 2. KMeans èšç±»
    // 3. è¿”å›åˆ†ç»„ç»“æœ
}
```

**æ­¥éª¤ 5ï¼šå®ç°æ‘˜è¦ç”Ÿæˆ**
```go
// internal/rag/biz/summarizer.go
type Summarizer struct {
    chatProvider llm.ChatProvider
}

func (s *Summarizer) Summarize(ctx context.Context, content string) (string, error) {
    prompt := buildSummaryPrompt(content)
    resp, err := s.chatProvider.Chat(ctx, prompt)
    // å¤„ç†å“åº”
}
```

**æ­¥éª¤ 6ï¼šå®ç° TreeBuilder æ ¸å¿ƒ**
```go
// internal/rag/biz/tree_builder.go
func (tb *TreeBuilder) BuildTree(ctx context.Context, doc *Document) error {
    // 1. è·å–å¶å­èŠ‚ç‚¹ï¼ˆå¤ç”¨ Indexerï¼‰
    leafNodes := tb.getLeafNodes(doc)

    // 2. é€’å½’æ„å»º
    rootNodes := tb.buildLevels(ctx, leafNodes, 0)

    // 3. å­˜å‚¨
    return tb.saveTree(ctx, rootNodes)
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… èƒ½æ„å»º 2-3 å±‚æ ‘ç»“æ„
- âœ… èŠ‚ç‚¹çˆ¶å­å…³ç³»æ­£ç¡®
- âœ… æ‘˜è¦è´¨é‡å¯æ¥å—
- âœ… å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%

---

### ç¬¬ä¸‰é˜¶æ®µï¼šTreeRetriever å®ç°ï¼ˆ7-10 å¤©ï¼‰

**æ­¥éª¤ 7ï¼šå®ç°è·¯å¾„æŸ¥æ‰¾**
```go
// internal/rag/biz/path_finder.go
func (pf *PathFinder) FindPaths(
    ctx context.Context,
    queryEmbedding []float32,
    topK int,
) ([]*TreeNode, error) {
    // 1. æŸ¥æ‰¾æ ¹èŠ‚ç‚¹
    roots := pf.searchByLevel(queryEmbedding, maxLevel, topK)

    // 2. é€’å½’å‘ä¸‹
    for _, root := range roots {
        pathNodes = pf.traverseDown(root, queryEmbedding)
    }

    return pathNodes
}
```

**æ­¥éª¤ 8ï¼šå®ç° TreeRetriever**
```go
// internal/rag/biz/tree_retriever.go
func (tr *TreeRetriever) Retrieve(ctx context.Context, query string) (*RetrievalResult, error) {
    // 1. è·¯å¾„æŸ¥æ‰¾
    pathNodes := tr.pathFinder.FindPaths(queryEmbedding, 3)

    // 2. å¶å­æ£€ç´¢
    leafNodes := tr.retrieveLeafNodes(queryEmbedding, 20)

    // 3. ç»¼åˆæ’åº
    return tr.rankAndMerge(pathNodes, leafNodes)
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… èƒ½æ­£ç¡®æ£€ç´¢å¤šå±‚èŠ‚ç‚¹
- âœ… æ’åºç®—æ³•åˆç†
- âœ… æ£€ç´¢å»¶è¿Ÿå¯æ¥å—ï¼ˆ< 2sï¼‰

---

### ç¬¬å››é˜¶æ®µï¼šé›†æˆå’ŒéªŒè¯ï¼ˆ11-15 å¤©ï¼‰

**æ­¥éª¤ 9ï¼šé›†æˆåˆ° RAGService**
```go
// internal/rag/biz/service.go
type RAGService struct {
    // ... ç°æœ‰å­—æ®µ
    treeBuilder   *TreeBuilder   // æ–°å¢
    treeRetriever *TreeRetriever // æ–°å¢
}

func (s *RAGService) IndexFromURL(ctx context.Context, url string) error {
    // ç°æœ‰é€»è¾‘
    err := s.indexer.IndexFromURL(ctx, url)

    // æ–°å¢ï¼šæ ‘ç´¢å¼•ï¼ˆå¯é€‰ï¼‰
    if s.config.Tree.Enabled {
        _ = s.treeBuilder.BuildTree(ctx, doc) // å¤±è´¥ä¸é˜»å¡
    }
    return err
}

func (s *RAGService) Query(ctx context.Context, question string) (*QueryResult, error) {
    // ç°æœ‰å‘é‡æ£€ç´¢
    vecResult := s.retriever.Retrieve(ctx, question)

    // æ–°å¢ï¼šæ ‘æ£€ç´¢ï¼ˆå¯é€‰ï¼‰
    if s.config.Tree.Enabled {
        treeResult := s.treeRetriever.Retrieve(ctx, question)
        return s.mergeResults(vecResult, treeResult) // èåˆ
    }

    return vecResult, nil
}
```

**æ­¥éª¤ 10ï¼šç¼–å†™æµ‹è¯•**
```go
// internal/rag/biz/service_integration_test.go
func TestRAGService_WithTreeEnabled(t *testing.T) {
    // 1. å‡†å¤‡æµ‹è¯•æ–‡æ¡£
    doc := createTestDocument(5000) // 5000 å­—

    // 2. ç´¢å¼•
    err := service.IndexFromURL(ctx, doc.URL)
    assert.NoError(t, err)

    // 3. éªŒè¯æ ‘ç»“æ„
    // - æŸ¥è¯¢æ ¹èŠ‚ç‚¹
    // - éªŒè¯å±‚çº§å…³ç³»

    // 4. æ‰§è¡ŒæŸ¥è¯¢
    result := service.Query(ctx, "å¤æ‚é—®é¢˜")

    // 5. å¯¹æ¯”å‘é‡æ£€ç´¢ç»“æœ
    assert.Greater(t, result.Accuracy, baselineAccuracy*1.15)
}
```

**æ­¥éª¤ 11ï¼šå¯¹æ¯”æµ‹è¯•**
```bash
# å‡†å¤‡æµ‹è¯•æ•°æ®é›†
# - 10 ç¯‡æ–‡æ¡£ï¼ˆæ¯ç¯‡ 3000-5000 å­—ï¼‰
# - 30 ä¸ªæŸ¥è¯¢ï¼ˆç®€å• 10 + å¤æ‚ 10 + é•¿å°¾ 10ï¼‰

# è¿è¡Œå¯¹æ¯”æµ‹è¯•
go test ./internal/rag/biz/... -tags=integration -v

# ç”Ÿæˆå¯¹æ¯”æŠ¥å‘Š
# - Recall@10
# - Precision@10
# - æ£€ç´¢å»¶è¿Ÿ
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… å¤æ‚æŸ¥è¯¢å‡†ç¡®ç‡æå‡ > 15%
- âœ… æ‰€æœ‰ç°æœ‰æµ‹è¯•é€šè¿‡
- âœ… æ— å†…å­˜æ³„æ¼
- âœ… é…ç½®å¼€å…³æ­£å¸¸å·¥ä½œ

---

## ğŸ§ª æµ‹è¯•è®¡åˆ’

### å•å…ƒæµ‹è¯•

**TreeBuilder æµ‹è¯•**ï¼š
```go
func TestTreeBuilder_BuildTree_SmallDocument(t *testing.T)
func TestTreeBuilder_BuildTree_LargeDocument(t *testing.T)
func TestTreeBuilder_BuildLevels_Recursion(t *testing.T)
func TestTreeBuilder_CreateParentNode_Success(t *testing.T)
```

**TreeRetriever æµ‹è¯•**ï¼š
```go
func TestTreeRetriever_Retrieve_PathFinding(t *testing.T)
func TestTreeRetriever_Retrieve_LeafRetrieval(t *testing.T)
func TestTreeRetriever_RankNodes_Scoring(t *testing.T)
```

**Mock ç­–ç•¥**ï¼š
- Mock ChatProviderï¼šè¿”å›å›ºå®šæ‘˜è¦ï¼Œé¿å…çœŸå® LLM è°ƒç”¨
- Mock VectorStoreï¼šä½¿ç”¨å†…å­˜å­˜å‚¨
- Mock Embedderï¼šè¿”å›å›ºå®šå‘é‡

### é›†æˆæµ‹è¯•

**åœºæ™¯ 1ï¼šå®Œæ•´ç´¢å¼•æµç¨‹**
- è¾“å…¥ï¼š5000 å­—æ–‡æ¡£
- éªŒè¯ï¼šæ ‘å±‚çº§ã€èŠ‚ç‚¹å…³ç³»ã€å¶å­æ•°é‡

**åœºæ™¯ 2ï¼šæ£€ç´¢è´¨é‡å¯¹æ¯”**
- å‘é‡æ£€ç´¢ vs æ ‘æ£€ç´¢
- æŒ‡æ ‡ï¼šRecall@10, Precision@10, MRR

**åœºæ™¯ 3ï¼šç»“æœèåˆæ•ˆæœ**
- éªŒè¯å»é‡ã€æ’åºã€è´¨é‡

### å¯¹æ¯”æµ‹è¯•

**æµ‹è¯•æ•°æ®é›†**ï¼š
- 10 ç¯‡æ–‡æ¡£ï¼ˆæ¯ç¯‡ 3000-5000 å­—ï¼‰
- 30 ä¸ªæŸ¥è¯¢ï¼ˆåˆ†ä¸‰ç±»ï¼‰

**è¯„ä¼°æŒ‡æ ‡**ï¼š
- æ£€ç´¢è´¨é‡ï¼šRecall@K, Precision@K, NDCG@K
- æ€§èƒ½ï¼šç´¢å¼•æ—¶é—´ã€æ£€ç´¢å»¶è¿Ÿã€å­˜å‚¨å¼€é”€
- æˆæœ¬ï¼šLLM è°ƒç”¨æ¬¡æ•°ã€Token æ¶ˆè€—

**å¯¹æ¯”å®éªŒ**ï¼š
```
å®éªŒç»„ 1: çº¯å‘é‡æ£€ç´¢ï¼ˆBaselineï¼‰
å®éªŒç»„ 2: çº¯æ ‘æ£€ç´¢
å®éªŒç»„ 3: èåˆæ£€ç´¢ï¼ˆæœ¬æ–¹æ¡ˆï¼‰
```

---

## âš ï¸ é£é™©å’Œç¼“è§£æªæ–½

### é«˜é£é™©ï¼ˆå¿…é¡»å…³æ³¨ï¼‰

**é£é™© 1ï¼šLLM æ‘˜è¦è´¨é‡ä¸ç¨³å®š**
- å½±å“ï¼šä¸Šå±‚èŠ‚ç‚¹æ£€ç´¢å‡†ç¡®ç‡ä¸‹é™
- ç¼“è§£ï¼š
  1. å¤šè½®éªŒè¯ï¼Œè´¨é‡ä½æ—¶é‡æ–°ç”Ÿæˆ
  2. Fallback åˆ°å†…å®¹æˆªæ–­ + å…³é”®è¯æå–
  3. ä½¿ç”¨æ¨¡æ¿åŒ– Prompt

**é£é™© 2ï¼šç´¢å¼•æ„å»ºæ—¶é—´è¿‡é•¿**
- å½±å“ï¼šç”¨æˆ·ä½“éªŒå·®
- ç¼“è§£ï¼š
  1. ä½¿ç”¨ pool æ§åˆ¶å¹¶å‘ï¼ˆå·²è®¾è®¡ï¼‰
  2. æ‰¹é‡ç”Ÿæˆæ‘˜è¦
  3. è®¾ç½®è¶…æ—¶å’Œé™çº§
  4. å¼‚æ­¥æ„å»ºæ¨¡å¼

**é£é™© 3ï¼šæ£€ç´¢å»¶è¿Ÿå¢åŠ **
- å½±å“ï¼šå“åº”æ—¶é—´å˜æ…¢
- ç¼“è§£ï¼š
  1. æ·»åŠ è·¯å¾„ç¼“å­˜
  2. å¹¶è¡ŒæŸ¥è¯¢å­èŠ‚ç‚¹
  3. é™åˆ¶æ ‘æ·±åº¦ï¼ˆmax_level=3ï¼‰
  4. è¶…æ—¶é™çº§åˆ°å‘é‡æ£€ç´¢

### ä¸­é£é™©ï¼ˆéœ€è¦ç›‘æ§ï¼‰

**é£é™© 4ï¼šå­˜å‚¨å¼€é”€æ¿€å¢**
- å½±å“ï¼šæˆæœ¬å¢åŠ 
- ç¼“è§£ï¼š
  1. POC é˜¶ï¿½ï¿½å®æµ‹æˆæœ¬
  2. å®ç° TTL æ¸…ç†æœºåˆ¶
  3. ä»…ä¸ºé‡è¦æ–‡æ¡£æ„å»ºæ ‘

**é£é™© 5ï¼šä»£ç å¤æ‚åº¦é«˜**
- å½±å“ï¼šç»´æŠ¤å›°éš¾
- ç¼“è§£ï¼š
  1. æ¨¡å—åŒ–è®¾è®¡
  2. ä¸°å¯Œæ³¨é‡Šå’Œæ–‡æ¡£
  3. å¯è§†åŒ–å·¥å…·

---

## âœ… éªŒè¯æ–¹æ³•

### æœ¬åœ°éªŒè¯ï¼ˆå¼€å‘é˜¶æ®µï¼‰

```bash
# 1. å•å…ƒæµ‹è¯•
go test ./internal/rag/biz/... -v -cover

# 2. é›†æˆæµ‹è¯•
go test ./internal/rag/biz/... -tags=integration -v

# 3. ä»£ç è¦†ç›–ç‡
go test -coverprofile=coverage.out ./internal/rag/biz/...
go tool cover -html=coverage.out

# 4. ç«æ€æ£€æµ‹
go test -race ./internal/rag/biz/...

# 5. å†…å­˜æ³„æ¼æ£€æµ‹
go test -memprofile=mem.prof ./internal/rag/biz/...
go tool pprof mem.prof
```

### åŠŸèƒ½éªŒè¯ï¼ˆæ‰‹åŠ¨æµ‹è¯•ï¼‰

```bash
# 1. å¯åŠ¨æœåŠ¡
make run-dev

# 2. ç´¢å¼•æµ‹è¯•æ–‡æ¡£
curl -X POST http://localhost:8080/v1/rag/index \
  -H "Content-Type: application/json" \
  -d '{"source_url": "https://example.com/doc.md"}'

# 3. éªŒè¯æ ‘ç»“æ„ï¼ˆæŸ¥è¯¢ Milvusï¼‰
# æ£€æŸ¥ level, parent_id å­—æ®µæ˜¯å¦æ­£ç¡®

# 4. æ‰§è¡ŒæŸ¥è¯¢
curl -X POST http://localhost:8080/v1/rag/query \
  -H "Content-Type: application/json" \
  -d '{"question": "å¤æ‚é—®é¢˜ï¼šç³»ç»Ÿæ¶æ„æ˜¯å¦‚ä½•è®¾è®¡çš„ï¼Ÿ"}'

# 5. å¯¹æ¯”ç»“æœ
# - å¼€å¯ tree.enabled=true çš„ç»“æœ
# - å…³é—­ tree.enabled=false çš„ç»“æœ
```

### æ€§èƒ½éªŒè¯

```bash
# 1. ç´¢å¼•æ€§èƒ½æµ‹è¯•
# æµ‹è¯•ä¸åŒæ–‡æ¡£å¤§å°çš„ç´¢å¼•æ—¶é—´

# 2. æ£€ç´¢æ€§èƒ½æµ‹è¯•
# ä½¿ç”¨ wrk æˆ– hey è¿›è¡Œå‹æµ‹
hey -n 1000 -c 10 -m POST \
  -H "Content-Type: application/json" \
  -d '{"question":"æµ‹è¯•é—®é¢˜"}' \
  http://localhost:8080/v1/rag/query

# 3. åˆ†ææ€§èƒ½æŠ¥å‘Š
# P50, P95, P99 å»¶è¿Ÿ
# QPS
```

---

## ğŸ“Š æˆåŠŸæ ‡å‡†

### å¿…é¡»æ»¡è¶³ï¼ˆP0ï¼‰
- âœ… å¤æ‚æŸ¥è¯¢ Recall@10 æå‡ > 15%
- âœ… æ£€ç´¢å»¶è¿Ÿ P95 < 2 ç§’
- âœ… æ‰€æœ‰ç°æœ‰æµ‹è¯•é€šè¿‡
- âœ… å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%
- âœ… æ— å†…å­˜æ³„æ¼ã€æ— ç«æ€æ¡ä»¶

### æœŸæœ›æ»¡è¶³ï¼ˆP1ï¼‰
- âœ… ç®€å•æŸ¥è¯¢å‡†ç¡®ç‡ä¸ä¸‹é™
- âœ… æ„å»ºæˆæœ¬ < $500
- âœ… å­˜å‚¨å¼€é”€ < 2 å€

### å¯é€‰æ»¡è¶³ï¼ˆP2ï¼‰
- âœ… å¢é‡æ›´æ–°æœºåˆ¶
- âœ… å¯è§†åŒ–å·¥å…·
- âœ… è¯¦ç»†æ–‡æ¡£

---

## ğŸ“… æ—¶é—´è¡¨

| é˜¶æ®µ | ä»»åŠ¡ | æ—¶é—´ | äº¤ä»˜ç‰© |
|------|------|------|--------|
| **é˜¶æ®µ 1** | åŸºç¡€è®¾æ–½å‡†å¤‡ | 1-2 å¤© | Schema æ‰©å±•ã€é…ç½®æ–‡ä»¶ |
| **é˜¶æ®µ 2** | TreeBuilder å®ç° | 3-6 å¤© | æ ‘æ„å»ºé€»è¾‘ã€å•å…ƒæµ‹è¯• |
| **é˜¶æ®µ 3** | TreeRetriever å®ç° | 7-10 å¤© | æ£€ç´¢é€»è¾‘ã€é›†æˆæµ‹è¯• |
| **é˜¶æ®µ 4** | é›†æˆå’ŒéªŒè¯ | 11-15 å¤© | å¯¹æ¯”æµ‹è¯•æŠ¥å‘Šã€æ–‡æ¡£ |

**æ€»è®¡**ï¼š10-15 å¤©

---

## ğŸ“ äº¤ä»˜ç‰©æ¸…å•

1. **ä»£ç **ï¼š
   - æ‰©å±•åçš„ VectorStore æ¥å£
   - TreeBuilder å®ç°ï¼ˆ3 ä¸ªæ–‡ä»¶ï¼‰
   - TreeRetriever å®ç°ï¼ˆ2 ä¸ªæ–‡ä»¶ï¼‰
   - RAGService é›†æˆ
   - å®Œæ•´çš„å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•

2. **æ–‡æ¡£**ï¼š
   - æŠ€æœ¯è®¾è®¡æ–‡æ¡£
   - é…ç½®æŒ‡å—
   - æµ‹è¯•æŠ¥å‘Š

3. **æŠ¥å‘Š**ï¼š
   - å¯¹æ¯”æµ‹è¯•æŠ¥å‘Šï¼ˆå‘é‡ vs æ ‘ vs èåˆï¼‰
   - æ€§èƒ½åŸºå‡†æµ‹è¯•æŠ¥å‘Š
   - æˆæœ¬åˆ†ææŠ¥å‘Š

4. **é…ç½®**ï¼š
   - æ›´æ–°åçš„ `configs/rag.yaml`
   - é…ç½®è¯´æ˜æ–‡æ¡£

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³æ‰§è¡Œ
1. ä¿®æ”¹ `internal/rag/store/store.go` - 